name: Add Asana comment on PR created

on:
  pull_request:
    types: [opened, edited, labeled, unlabeled]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Set PR number
        run: |
          PR_NUMBER=$(echo -n $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }')
          echo -n "PR Number: $PR_NUMBER"
      - name: Post comment
        env:
          PR_NUMBER2: ${{ github.event.number }}
        uses: everphone-gmbh/github-asana-action@master
        with:
          asana-pat: ${{ secrets.ASANA_PAT }}
          action: "add-comment"
          comment-id: "#pr:$PR_NUMBER"
          text: "Pull Request: https://github.com/whisklabs/atlas/pull/$PR_NUMBER 1: ${{env.PR_NUMBER}} 2: ${{ env.PR_NUMBER2 }} 3: ${{ secrets.ASANA_PAT }}"
          is-pinned: true
